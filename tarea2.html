<!DOCTYPE html>
<html lang="en">
<head>
	<title>Avo - Free Bootstrap 4 Template by Colorlib</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	
	<link href="https://fonts.googleapis.com/css?family=Nunito+Sans:200,300,400,600,700,800,900&display=swap" rel="stylesheet">

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

	<link rel="stylesheet" href="css/animate.css">
	
	<link rel="stylesheet" href="css/owl.carousel.min.css">
	<link rel="stylesheet" href="css/owl.theme.default.min.css">
	<link rel="stylesheet" href="css/magnific-popup.css">
	
	<link rel="stylesheet" href="css/flaticon.css">
	<link rel="stylesheet" href="css/style.css">


	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	
	<script src="https://d3js.org/d3.v3.min.js"></script>
	<script>
		var d3v3 = window.d3;
		window.d3 = null;
	</script>

	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script>
		var d3v4 = window.d3;
		window.d3 = null;
	</script>

	<script src="https://d3js.org/d3.v6.min.js"></script>
	<script>
		var d3v6 = window.d3;
		window.d3 = null;
	</script>

	<!--<script src="/js/tarea2_readfile.js"></script>-->


	<style>
		body {
		  font: 10px sans-serif;
		}
		
		.axis path,
		.axis line {
		  fill: none;
		  stroke: #000;
		  shape-rendering: crispEdges;
		}	
	</style>


</head>
<body>
	
	<nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
		<div class="container">
			
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
				<span class="oi oi-menu"></span> Menu
			</button>

			<div class="collapse navbar-collapse" id="ftco-nav">
				<ul class="navbar-nav ml-auto">
					<li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
					<li class="nav-item"><a href="tarea1.html" class="nav-link">Tarea 1</a></li>
					<li class="nav-item active"><a href="tarea2.html" class="nav-link">Tarea 2</a></li>
					<li class="nav-item"><a href="tarea3.html" class="nav-link">Tarea 3</a></li>
				</ul>
			</div>
		</div>
	</nav>
	<!-- END nav -->

	<section class="hero-wrap hero-wrap-2 degree-right" style="background-image: url('images/bg_5.jpg');" data-stellar-background-ratio="0.5">
		<div class="overlay"></div>
		<div class="container">
			<div class="row no-gutters slider-text js-fullheight align-items-end">
				<div class="col-md-9 ftco-animate pb-5 mb-5">
					<p class="breadcrumbs"><span class="mr-2"><a href="index.html">Home <i class="fa fa-chevron-right"></i></a></span> <span>EMISIONES ANUALES DE CO2<i class="fa fa-chevron-right"></i></span></p>
					<h1 class="mb-3 bread">EMISIONES ANUALES DE CO2</h1>
				</div>
			</div>
		</div>
	</section>

	<section class="ftco-section ftco-portfolio">
		<div class="row justify-content-center no-gutters">
			<div class="col-md-12 heading-section text-center ftco-animate mb-5">
				<h2 class="mb-2">EMISIONES ANUALES DE CO2</h2>
			</div>
		</div>		
		
		<div class="container">

			<div width=100%>
				<div class="text text-md-center">
					<h2>Emisiones de CO2 desde zona seleccionada hacia las demás</h2>
					<p style="font-size:20px">A continuación, se muestran las emisiones que hay en total (transporte publico + transporte privado) desde la zona y año seleccionado hacia las demás zonas. Es posible ordenar los datos tanto ascendente como descendentemente, con el fin de observar y analizar los mínimos y máximos.</p>
					<p style="font-size:15px">Puede seleccionar la barra que desee y observar en el mapa a que zona pertenece de acuerdo a su color. Igualmente puede observar el valor en barra, pasando el mouse sobre cada conjunto de barras. Hay un punto central, hacia la derecha se muestran las emisiones de CO2 generadas por transporte privado, mientras que a la izquierda se muestran las emisiones generadas por transporte público</p>
				</div>
			</div>

			<section>
				<div align ="center">
					<select id="selectButtonOrdenamiento" class="textmenus"></select>
				</div>
			</section>
			
			<br></br>
			<br></br>

			<table class="egt">
				<tr>
					<td>
						<div>
							<p style="font-size:15px ; color:black; text-align:center;"><b>EMISIONES DE CO2 TOTALES POR ZONA EN HORA VALLE</b></p>
						</div>
					</td>
					<td>
						<div>
							<p style="font-size:15px ; color:black; text-align:center;"><b>EMISIONES DE CO2 TOTALES POR ZONA EN HORA PICO</b></p>
						</div>
					</td>
				</tr>
				<tr>
					<td>
					  <div class="dataviz" id="dataviz">
						  <svg></svg>
					  </div>
					</td>
					<td>
					  <div class="dataviz2" id="dataviz2">
						  <svg></svg>
					  </div>
					</td>
				  </tr>
			</table>

			<div width=100%>
				<div class="text text-md-center">
					<h2>Mapa de las UPZ (Unidad de Planeamiento Zonal) de la ciudad de Bogotá</h2>
					<p style="font-size:20px">A continuación, se muestran el mapa de Bogotá al cual se le aplicó una escala de color verde para determinar el nivel de emisiones de CO2 promedio en cada zona.</p>
					<p style="font-size:15px">Al pasar el mouse sobre las diferentes zonas, podrá ver en la esquina superior izquierda el nombre y número de esa zona.
						Al seleccionar una zona ya sea en el mapa, o en el combo box de zonas, podrá ver la información de dicha zona seleccionada en la esquina superior derecha.
						Para ver la información de las zonas seleccionadas en las gráficas de barras puede observar la esquina inferior derecha.
						Para ver la información de las zonas seleccionadas en las gráficas de líneas puede observar la esquina inferior izquierda.
						En todos los casos, cada zona seleccionada tendrá un color diferente.
					</p>
				</div>
			</div>


			<section>	
				<div class="datavizMap" id="datavizMap">
					
					<select id="selectButton" class="textmenus"></select>
					<select id="selectButtonHora" class="textmenus"></select>
					<select id="selectButtonZonas" class="textmenus" style="float: right;"></select>
					<svg></svg>
				</div>
			</section>


			</br>


			<div class = "rangelimit" id = "rangelimit">
				<label for="nRadius"  class="textmenus">
					Límite de zonas = <span id="nRadius-value">…</span>
		 		</label>
				<input type="range" min="01" max="127" id="nRadius">
			</div>

	

			<div width=100%>
				<div class="text text-md-center">
					<h2>Cambios anuales en la cantidad de emisiones de CO2</h2>
					<p style="font-size:20px">A continuación, se muestran los cambios que hay por año, en las cantidades de emisión de CO2 (en Toneladas) de las diferentes zonas destino. Estas zonas son las mismas que aparecen en el gráfico de barras de la parte superior.</p>
					<p style="font-size:15px">Puede seleccionar la línea que desee y observar en el mapa a que zona pertenece de acuerdo a su color. Igualmente puede observar el valor en cada año para cada zona, pasando el mouse sobre los puntos. Si desea eliminar una línea para analizar mejor las tendencias puede presionar la tecla “Control + click” (Ctrl+Click) sobre la linea.</p>
				</div>
			</div>

			<table class="egt2">
				<tr>
					<td>
						<div>
							<p style="font-size:15px ; color:black; text-align:center;"><b>CAMBIOS POR AÑOS EN HORA VALLE </b></p>
						</div>
					</td>
					<td>
						<div>
							<p style="font-size:15px ; color:black; text-align:center;"><b>CAMBIOS POR AÑOS EN HORA PICO </b></p>
						</div>
					</td>
				</tr>
				<tr>
					<td>
					  <div class="datavizlin1" id="datavizlin1">
						  <svg></svg>
					  </div>
					</td>
					<td>
					  <div class="datavizlin2" id="datavizlin2">
						  <svg></svg>
					  </div>
					</td>
				</tr>
				
			</table>
				


 
			<!--Estilos-->
			<style>
				@import url(https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300|Josefin+Slab|Arvo|Lato|Vollkorn|Abril+Fatface|Old+Standard+TT|Droid+Sans|Lobster|Inconsolata|Montserrat|Playfair+Display|Karla|Alegreya|Libre+Baskerville|Merriweather|Lora|Archivo+Narrow|Neuton|Signika|Questrial|Fjalla+One|Bitter|Varela+Round);
				
				.background {
				  fill: #eee;
				  pointer-events: all;
				}
				
				.map-layer {
				  fill: #fff;
				  stroke: #aaa;
				}
				
				.effect-layer{
				  pointer-events:none;
				}
				
				text{
				  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
				  font-weight: 300;
				}
				
				text.big-text{
				  font-size: 30px;
				  font-weight: 400;
				}
				
				.effect-layer text, text.dummy-text{
				  font-size: 12px;
				}				
			</style>



			<style>
				svg {
				width: 100%;
				height: 100%;
				position: center;
				}

				.line:hover{
				fill: none;
					stroke-width: 6;
				}
				
				.axis--x path {
				fill: none;
				display: yellow;
				} 
			</style>

			<style>
				.textmenus{
					font-size: 20px;
				}
			</style>

			<!--ESTILO DEL TOOLTIP DE PUNTOS-->
			<style>
				div.tooltip2 {	
					position: absolute;			
					text-align: center;			
					width: 70px;					
					height: 38px;					
					padding: 2px;				
					font: 12px sans-serif;	
					color: black;	
					background: lightsteelblue;	
					border: 1px;		
					border-radius: 8px;			
					pointer-events: none;			
				}
			</style>



			<script>
				var prefix = "/PlanificacionUrbanaBogota";
				var url_data = prefix+"/Data/Co2_Emissions.json";
				var url_dataLinePeak = prefix+"/Data/Co2_LineChart_TotalPeak.json";
				var url_dataLineOPeak = prefix+"/Data/Co2_LineChart_TotalOPeak.json";
				var urlMap = prefix+"/Data/zonas_luti.json";
				var url_data_test = prefix+"/Data/browser_statistics.csv"

				//-----------------------------------------------------------------------------------------------------------------------------------
				//MAPA
				var widthMap = 960,
				heightMap = 500,
				centeredMap;

				var isLineSelected = false;
				var isElementSelected = false;
				var lineSelected;
				var elementSelected;
				var cantElements = 10;
				var selectedAnio = "0";
				var topselected = "10";
				var barSelected;
				var ordenamiento = "DES"; //DES - descendiente ; ASC - Ascendente
				var selectedHora = "hora pico";

				//COLORES A USAR EN TODA LA VISUALIZACION
				var color_co2_tm_opeak = "#a6d96a";
				var color_co2_tpc_opeak = "#66bd63";
				var color_co2_car_opeak = "#1a9850";
				var color_co2_tm_peak = "#a6d96a";
				var color_co2_tpc_peak = "#66bd63";
				var color_co2_car_peak = "#1a9850";
				var color_comodin = "#FFFFFF"; //Debido a que hay categorias impares
				

				var color_on_selection = 'orange';
				var color_clicked_province = '#D5708B';
				var color_selected_destination = '#8A2BFF';

				var rows1;
				var rows2;


				//Funcion para convertir en 
				var parseTimeLin = 	d3v4.timeParse("%y");

				// Define color scale
				var colorMap = d3v3.scale.linear()
				.domain([1, 20])
				.clamp(true)
				.range(['#fff', '#409A99']);

				var projectionMap = d3v3.geo.mercator()
				
				// Center the Map in Colombia
				.center([-74.1, 4.65])
				.translate([widthMap / 2, heightMap / 2])
				.scale(75000);

				var pathMap = d3v3.geo.path().projection(projectionMap);

				// Set svg width & height
				var svgMap = d3v3.select(".datavizMap > svg")
				.attr("width",widthMap)  // apply width,height to svg
				.attr("height",heightMap);

				svgMap.append('rect')
				.attr('class', 'background')
				.attr('width', widthMap)
				.attr('height', heightMap)
				;
				
				var gMap = svgMap.append('g');

				var mapLayer = gMap.append('g')
				.classed('map-layer', true);

				var dummyTextMap = gMap.append('text')
				.classed('dummy-text', true)
				.attr('x', 10)
				.attr('y', 30)
				.attr('stroke','black')
				.attr('stroke-width','0.3px')
				.style("font-size", "14pt")
				.style('opacity', 0)
				.style('fill', color_on_selection);

				var dummyText2Map = gMap.append('text')
				.classed('dummy-text', true)
				.attr('x', 10)
				.attr('y', 50)
				.attr('font-weight','bold')
				.style("font-size", "14pt")
				.style('opacity', 0)
				.style('fill', color_on_selection);

				var dummyTextMap_selected = gMap.append('text')
				.classed('dummy-text', true)
				.attr('x', widthMap-370)
				.attr('y', 30)
				.style("font-size", "14pt")
				.style('opacity', 0)
				.style('fill', color_clicked_province);

				var dummyTextMap_destination = gMap.append('text')
				.classed('dummy-text', true)
				.attr('x', widthMap-370)
				.attr('y', heightMap-100)
				.style("font-size", "14pt")
				.style('opacity', 0)
				.style('fill', color_selected_destination);


				var dummyTextMap_destination_line = gMap.append('text')
				.classed('dummy-text', true)
				.attr('x', 10)
				.attr('y', heightMap-100)
				.style("font-size", "14pt")
				.style('opacity', 0);


				// List of groups (here I have one group per column)
				var allGroupOrdenamiento = ["Descendente","Ascendente"];
    			var allGroup = ["año 0", "año 1", "año 2", "año 3", "año 4", "año 5"];
				var allHoras = ["hora pico","hora valle"];
				var allGroupZonas = ["UPZ 22 - 12 de Octubre",
									"UPZ 34 - 20 de Julio",
									"UPZ 117 - Aeropuerto Eldorado",
									"UPZ 116 - Álamos",
									"UPZ 59 - Alfonso López",
									"UPZ 44 - Américas",
									"UPZ 49 - Apogeo",
									"UPZ 65 - Arborizadora",
									"UPZ 113 - Bavaria",
									"UPZ 72 - Bolivia",
									"UPZ 85 - Bosa Central",
									"UPZ 84 - Bosa Occidental",
									"UPZ 30 - Boyacá Real",
									"UPZ 18 - Britalia",
									"UPZ 79 - Calandaima",
									"UPZ 115 - Capellanía",
									"UPZ 45 - Carvajal",
									"UPZ 23 - Casablanca SUba",
									"UPZ 46 - Castilla",
									"UPZ 99 - Chapinero",
									"UPZ 97 - Chicó Lago",
									"UPZ 35 - Ciudad Jardín",
									"UPZ 40 - Ciudad Montes",
									"UPZ 110 - Ciudad Salitre Occidente",
									"UPZ 109 - Ciudad Salitre Oriental",
									"UPZ 61 - Ciudad Usme",
									"UPZ 58 - Comuneros",
									"UPZ 80 - Corabastos",
									"UPZ 15 - Country Club",
									"UPZ 56 - Danubio",
									"UPZ 55 - Diana Turbay",
									"UPZ 63 - El Mochuelo",
									"UPZ 86 - El Porvenir",
									"UPZ 19 - El Prado",
									"UPZ 88 - El Refugio",
									"UPZ 28 - El Rincón",
									"UPZ 68 - El Tesoro",
									"UPZ 74 - Engativá",
									"UPZ 75 - Fontibón",
									"UPZ 76 - Fontibón-San Pablo",
									"UPZ 100 - Galerías",
									"UPZ 73 - Garcés Navas",
									"UPZ 81 - Gran Britalia",
									"UPZ 57 - Gran Yomasa",
									"UPZ 112 - Granjas de Techo",
									"UPZ 3 - Guaymaral",
									"UPZ 69 - Ismael Perdomo",
									"UPZ 105 - Jardín Botánico",
									"UPZ 70 - Jerusalén",
									"UPZ 47 - Kennedy Central",
									"UPZ 2 - La Academia",
									"UPZ 20 - La Alhambra",
									"UPZ 94 - La Candelaria",
									"UPZ 106 - La Esmeralda",
									"UPZ 52 - La Flora",
									"UPZ 25 - La Floresta",
									"UPZ 50 - La Gloria",
									"UPZ 92 - La Macarena",
									"UPZ 102 - La Sabana",
									"UPZ 10 - La Uribe",
									"UPZ 95 - Las Cruces",
									"UPZ 26 - Las Ferias",
									"UPZ 83 - Las Margaritas",
									"UPZ 93 - Las Nieves",
									"UPZ 98 - Los Alcázares",
									"UPZ 21 - Los Andes",
									"UPZ 13 - Los Cedros",
									"UPZ 51 - Los Libertadores",
									"UPZ 96 - Lourdes",
									"UPZ 67 - Lucero",
									"UPZ 53 - Marco Fidel Suárez",
									"UPZ 54 - Marruecos",
									"UPZ 29 - Minuto de Dios",
									"UPZ 114 - Modelia",
									"UPZ 64 - Monteblanco",
									"UPZ 41 - Muzú",
									"UPZ 24 - Niza",
									"UPZ 90 - Pardo Rubio",
									"UPZ 60 - Parque Entrenubes",
									"UPZ 103 - Parque Salitre",
									"UPZ 104 - Parque Simón Bolívar",
									"UPZ 1 - Paseo de los Libertadores",
									"UPZ 82 - Patio Bonito",
									"UPZ 111 - Puente Aranda",
									"UPZ 107 - Quinta Paredes",
									"UPZ 39 - Quiroga",
									"UPZ 38 - Restrepo",
									"UPZ 91 - Sagrado Corazón",
									"UPZ 32 - San Blas",
									"UPZ 11 - San Cristóbal Norte",
									"UPZ 66 - San Francisco",
									"UPZ 89 - San Isidro-Patios",
									"UPZ 36 - San José",
									"UPZ 17 - San José de Bavaria",
									"UPZ 43 - San Rafael",
									"UPZ 16 - Santa Bárbara",
									"UPZ 31 - Santa Cecilia",
									"UPZ 37 - Santa Isabel",
									"UPZ 33 - Sociego",
									"UPZ 27 - Suba",
									"UPZ 101 - Teusaquillo",
									"UPZ 71 - Tibabuyes",
									"UPZ 48 - Timiza",
									"UPZ 78 - Tintal Norte",
									"UPZ 87 - Tintal Sur",
									"UPZ 12 - Toberín",
									"UPZ 62 - Tunjuelito",
									"UPZ 14 - Usaquén",
									"UPZ 42 - Venecia",
									"UPZ 9 - Verbenal",
									"UPZ 77 - Zona Franca",
									"UPZ 108 - Zona Industrial"];

				//-------------------------------------------COMBO ordenamiento------------------------------------------------------------

				d3v3.select("#selectButtonOrdenamiento")
				.selectAll('myOptions')
					.data(allGroupOrdenamiento)
				.enter()
					.append('option')
				.text(function (d) { return d; }) // text showed in the menu
				.attr("value", function (d) { return d; });

				d3v3.select("#selectButtonOrdenamiento").on("change", function(d) {
					
					if (d3v3.select(this).property("value").toUpperCase() === "ASCENDENTE"){
						ordenamiento = "ASC";
					}
					else if(d3v3.select(this).property("value").toUpperCase() === "DESCENDENTE"){
						ordenamiento = "DES";	
					}
					updateCharts(selectedAnio.replace("año ",""),(elementSelected.properties.UPlCodigo).replace("UPZ","a"),cantElements)
					
				});
									

				//-------------------------------------------COMBO años------------------------------------------------------------



				// add the options to the button
				d3v3.select("#selectButton")
				.selectAll('myOptions')
					.data(allGroup)
				.enter()
					.append('option')
				.text(function (d) { return d; }) // text showed in the menu
				.attr("value", function (d) { return d; });

				d3v3.select("#selectButton").on("change", function(d) {
				// recover the option that has been chosen
				selectedAnio = d3v3.select(this).property("value")
				// run the updateChart function with this selected option
				
				updateCharts(selectedAnio.replace("año ",""),(elementSelected.properties.UPlCodigo).replace("UPZ","a"),cantElements)

				
				var arrayMap = mapLayer.selectAll('path');
				arrayMap.style("fill",function(d){
						return fillFn(d);

				});
				
    			});
				//-------------------------------------------COMBO de hora------------------------------------------------------------
				
				d3v3.select("#selectButtonHora")
				.selectAll('myOptions')
					.data(allHoras)
				.enter()
					.append('option')
				.text(function (d) { return d; }) // text showed in the menu
				.attr("value", function (d) { return d; });

				d3v3.select("#selectButtonHora").on("change", function(d) {
					selectedHora = d3v3.select(this).property("value")
				
					var arrayMap = mapLayer.selectAll('path');
					arrayMap.style("fill",function(d){
							return fillFn(d);
	
					});

				
    			});
				

				//-------------------------------------------Zonas------------------------------------------------------------
				d3v3.select("#selectButtonZonas")
				.selectAll('myOptions')
					.data(allGroupZonas)
				.enter()
					.append('option')
				.text(function (d) { return d; }) // text showed in the menu
				.attr("value", function (d) { return d; }) // corresponding value returned

				d3v3.select("#selectButtonZonas").style( 'color', color_clicked_province);

				d3v3.select("#selectButtonZonas").on("change", function(d) {
					var zona = d3v3.select(this).property("value");

					var resultado = zona.split("-")[0];
					resultado = resultado.replace("UPZ ", "a").replace(" ","");
					
					getElementAreaByUPZNameComboBoxZonas(resultado)
					
				});

				function changeComboBoxZonasValue(d){
					
					for (var i = 0 ; i<allGroupZonas.length; i++){
						if(allGroupZonas[i].includes(d.properties.UPlCodigo.replace("UPZ","UPZ "))){
							d3v3.select("#selectButtonZonas")
							.property("value",allGroupZonas[i]);
						}
					}
				}


				//-------------------------------------------SLIDER------------------------------------------------------------
				// when the input range changes update the circle 
				d3v3.select("#nRadius").on("input", function() {
					update(+this.value);
				});

				// Initial starting radius of the circle 
				update(topselected);

				// update the elements
				function update(valueslider) {

					topselected = valueslider;
					// adjust the text on the range slider
					d3v3.select("#nRadius-value").text(valueslider);
					d3v3.select("#nRadius").property("value", valueslider);

					//SE ACTUALIZAN LOS GRAFICOS DE BARRAS
					if(elementSelected != null){
						updateCharts(selectedAnio.replace("año ",""),(elementSelected.properties.UPlCodigo).replace("UPZ","a"),topselected);
					}
				}

				//-----------------------MAPA-------------------------------------------------------------------------------------



				d3v3.json(urlMap, 
				function(err, mapData) { 
					
					var features = mapData.features;

					elementSelected = features[Math.floor((Math.random() * (features.length-1)) + 1)];
				
					// Update color scale domain based on data
					colorMap.domain([0, d3v3.max(features, nameLength)]);

					// Draw each province as a path
					mapLayer.selectAll('path')
						.data(features)
						.enter().append('path')
						.attr('d', pathMap)
						.attr('vector-effect', 'non-scaling-stroke')
						.on('mouseover', mouseoverMap)
						.on('mouseout', mouseoutMap)
						.on('click', clickedMap);

				});

				// Get province name
				function nameFn(d){
				return d && d.properties ? d.properties.UPlNombre : null;
				}

				// Get upz
				function upzFn(d){
				return d && d.properties ? d.properties.UPlCodigo : null;
				}

				// Get province name length
				function nameLength(d){
					var n = nameFn(d);
					return n ? n.length : 0;
				}

				function mouseoverMap(d){
					if(d!=elementSelected){
						// Highlight hovered province
						d3v3.select(this).style('fill', color_on_selection);
						dummyTextMap.style('opacity', 1);
						dummyText2Map.style('opacity', 1);
						// Draw effects
						textArt(nameFn(d),upzFn(d));
					}
					
				}

				function mouseoutMap(d){
					if (d != elementSelected){
						// Highlight hovered province
						dummyTextMap.style('opacity', 0);
						dummyText2Map.style('opacity', 0);
						d3v3.select(this).style('fill', getColorofZone(d.properties.UPlCodigo.replace("UPZ","a")));
					}

					

				}

				// When clicked, zoom in
				function clickedMap(d) {
					changeComboBoxZonasValue(d)

					if(d === elementSelected && isElementSelected){
						isElementSelected = false;
						elementSelected = null;
						dummyTextMap_selected.style('opacity', 0);
					}
					else {
						elementSelected = d;
						isElementSelected = true;

						dummyTextMap_selected.style('opacity', 1);
						textArtSelected(nameFn(d),upzFn(d));
					}

					mapLayer.selectAll('path')
						.style('fill', function(d){return fillFn(d);});


					updateCharts(selectedAnio.replace("año ",""),(d.properties.UPlCodigo).replace("UPZ","a"),topselected);
				}


				function getElementAreaByUPZName(upz){
					upz = upz.replace("a","UPZ");
					var arrayMap = mapLayer.selectAll('path');
					arrayMap.style("fill",function(d){
						if(d.properties.UPlCodigo === upz){
							dummyTextMap_destination.style('opacity', 1);
							textArtDestination(nameFn(d),upzFn(d));
							return color_selected_destination;
						}
						else {
							return fillFn(d);
						}
					});
					
				}

				function fillAreaWithLineColor(upz,color){
					
					upz = upz.replace("a","UPZ");
					var arrayMap = mapLayer.selectAll('path');
					arrayMap.style("fill",function(d){
							return fillFn(d);
	
					});
				}

				function getElementAreaByUPZNameComboBoxZonas(upz){
					upz = upz.replace("a","UPZ");
					var arrayMap = mapLayer.selectAll('path');
					arrayMap.style("",function(d){
						if(d.properties.UPlCodigo === upz){
							clickedMap(d);
						}
						else {
							//return fillFn(d);
						}
					});
					
				}

				function textArtDestination(text1, text2){
					var textAux = text1+" ("+text2+")";
					dummyTextMap_destination.text(textAux);
				}

				function textArt(text1, text2){
					dummyTextMap.text(text1);
					dummyText2Map.text(text2);
				}

				function textArtSelected(text1, text2){
					var textAux = text1+" ("+text2+")";
					dummyTextMap_selected.html(textAux );
				}

				
				function textArtSelectedLine(text1, color){
					dummyTextMap_destination_line.html(text1 ).style('fill', color);
				}

				// Get province color
				function fillFn(d){
					
					if(elementSelected != null){
						if(d.properties.UPlCodigo === elementSelected.properties.UPlCodigo){
							return color_clicked_province;
						}
						//return color(nameLength(d));
					}

					if(barSelected != null){
					 	if(d.properties.UPlCodigo === barSelected.rows.replace("a","UPZ")){
							return color_selected_destination;
						}
					}

					if(lineSelected != null){
						if(d.properties.UPlCodigo === lineSelected.id.replace("a","UPZ")){
							
							return colorLin(lineSelected.id);
						}
					}

					return getColorofZone(d.properties.UPlCodigo.replace("UPZ","a"));
					

				}

				function getColorofZone(zona){
					var colorTotalScale;
					if(selectedHora == "hora pico"){
						colorTotalScale = d3v6.scaleQuantize([0, maxHoraPico], d3v6.schemeGreens[5]);
					}
					else{
						colorTotalScale = d3v6.scaleQuantize([0, maxHoraValle], d3v6.schemeGreens[5]);
					}

					return colorTotalScale(getTotalValueofZone(zona,selectedHora));


				}

				function getTotalValueofZone(zona,hora){
					
					for(var i = 0 ; i<misDatosMapEqualIJ.length;i++){
						if(misDatosMapEqualIJ[i]["anio"] == selectedAnio.replace("año ","") && misDatosMapEqualIJ[i]["zona"] == zona ){
							if(hora == "hola valle"){
								return misDatosMapEqualIJ[i]["horavalle"];
							}
							else {
								return misDatosMapEqualIJ[i]["horapico"];
							}
							
							
						}
					}
					
				}

				function updateCharts(anio,upz,cantidad){
					getData(anio,upz,cantidad);
				}


				//-----------------------------------------------------------------------------------------------------------------------------------
				//GRAFICOS DE BARRAS
				
				var graph_1_Tool_x_trans = 250;
				var graph_2_Tool_x_trans = 750;

				var margin = {top: 80, right: 20, bottom: 20, left: 50},
					width = (960/2 - margin.left - margin.right),
					height = 700/1.2 - margin.top - margin.bottom;
				
				var y = d3v3.scale.ordinal()
					.rangeRoundBands([0, height], .3);
				
				var x = d3v3.scale.linear()
					.rangeRound([0, width]);
				
				var xAxis = d3v3.svg.axis()
					.scale(x)
					.tickFormat(Math.abs)
					.orient("top");
				
				var yAxis = d3v3.svg.axis()
					.scale(y)
					.tickSize(0)
					.orient("left");
				
				var color = d3v3.scale.ordinal()
					//.range(["#d73027","#f46d43","#fdae61","#a6d96a","#66bd63","#1a9850"]);
					.range([color_co2_tm_opeak,color_co2_tpc_opeak,color_co2_car_opeak,color_comodin]);

				function compareItemsOPeak(a, b) {

					if(ordenamiento === "DES"){
						if (a.co2_car_opeak + a.co2_tm_opeak + a.co2_tpc_opeak < b.co2_car_opeak + b.co2_tm_opeak + b.co2_tpc_opeak) return 1;
						if (b.co2_car_opeak + b.co2_tm_opeak + b.co2_tpc_opeak < a.co2_car_opeak + a.co2_tm_opeak + a.co2_tpc_opeak) return -1;
						return 0;
					}
					else if (ordenamiento === "ASC"){
						if (a.co2_car_opeak + a.co2_tm_opeak + a.co2_tpc_opeak > b.co2_car_opeak + b.co2_tm_opeak + b.co2_tpc_opeak) return 1;
						if (b.co2_car_opeak + b.co2_tm_opeak + b.co2_tpc_opeak > a.co2_car_opeak + a.co2_tm_opeak + a.co2_tpc_opeak) return -1;
						return 0;
					}


					
				}

				function compareItemsPeak(a, b) {
					if(ordenamiento === "DES"){
						if (a.co2_tm_peak + a.co2_car_peak + a.co2_tpc_peak < b.co2_tm_peak + b.co2_car_peak + b.co2_tpc_peak) return 1;
						if (b.co2_tm_peak + b.co2_car_peak + b.co2_tpc_peak < a.co2_tm_peak + a.co2_car_peak + a.co2_tpc_peak) return -1;
						return 0;
					}

					else if (ordenamiento === "ASC"){
						if (a.co2_tm_peak + a.co2_car_peak + a.co2_tpc_peak > b.co2_tm_peak + b.co2_car_peak + b.co2_tpc_peak) return 1;
						if (b.co2_tm_peak + b.co2_car_peak + b.co2_tpc_peak > a.co2_tm_peak + a.co2_car_peak + a.co2_tpc_peak) return -1;
						return 0;
					}

					
				}


				var misDatos = [];
				var misDatosLinePeak = [];
				var misDatosLineOPeak = [];
				var misDatosMapEqualIJ = [];
				var maxHoraPico = 0;
				var maxHoraValle = 0;

				function readDataBarChart(){
					axios.get(url_data).then((response) => {
					cont = 0;
					for (var i = 0; i < response.data.length; i++) {
						
						//if(response.data[i].zi == zona && response.data[i].anio == anio){
							var datonuevo = {};
							datonuevo["zi"] = response.data[i].zi;
							datonuevo["rows"] = response.data[i].zj; //ZJ
							datonuevo["co2_tm_opeak"] = response.data[i].co2_tm_opeak;
							datonuevo["co2_tm_peak"] = response.data[i].co2_tm_peak;
							datonuevo["co2_car_peak"] = response.data[i].co2_car_peak;
							datonuevo["co2_car_opeak"] = response.data[i].co2_car_opeak;
							datonuevo["co2_tpc_peak"] = response.data[i].co2_tpc_peak;
							datonuevo["co2_tpc_opeak"] = response.data[i].co2_tpc_opeak;
							datonuevo["anio"] = response.data[i].anio;						
							misDatos.push(datonuevo);

							if (response.data[i].zi === response.data[i].zj){
								var datonuevoIgualZona = {};
								datonuevoIgualZona["zona"]=response.data[i].zi;
								datonuevoIgualZona["horapico"]=response.data[i].co2_tm_peak+response.data[i].co2_car_peak+response.data[i].co2_tpc_peak;
								datonuevoIgualZona["horavalle"]=response.data[i].co2_tm_opeak+response.data[i].co2_car_opeak+response.data[i].co2_tpc_opeak;
								datonuevoIgualZona["anio"] = response.data[i].anio;
								misDatosMapEqualIJ.push(datonuevoIgualZona);
								
								if(selectedAnio == response.data[i].anio && datonuevoIgualZona["horapico"] > maxHoraPico){
									maxHoraPico = datonuevoIgualZona["horapico"];
								}

								if(selectedAnio == response.data[i].anio && datonuevoIgualZona["horavalle"] > maxHoraValle){
									
									maxHoraValle = datonuevoIgualZona["horavalle"];
								}
							}

						//}
					}
					clickedMap(elementSelected)				
					})					
				}

				function readDataLineChart(){
					axios.get(url_dataLinePeak).then((response) => {
						for (var i = 0; i < response.data.length; i++) {
							var datonuevo = {};
							datonuevo["zi"] = response.data[i].zona;
							datonuevo["anio"] = response.data[i].anio;
							datonuevo["a1"] = response.data[i].a1;
							datonuevo["a2"] = response.data[i].a2;
							datonuevo["a3"] = response.data[i].a3;
							datonuevo["a4"] = response.data[i].a4;
							datonuevo["a5"] = response.data[i].a5;
							datonuevo["a6"] = response.data[i].a6;
							datonuevo["a7"] = response.data[i].a7;
							datonuevo["a8"] = response.data[i].a8;
							datonuevo["a9"] = response.data[i].a9;
							datonuevo["a10"] = response.data[i].a10;
							datonuevo["a11"] = response.data[i].a11;
							datonuevo["a12"] = response.data[i].a12;
							datonuevo["a13"] = response.data[i].a13;
							datonuevo["a14"] = response.data[i].a14;
							datonuevo["a15"] = response.data[i].a15;
							datonuevo["a16"] = response.data[i].a16;
							datonuevo["a17"] = response.data[i].a17;
							datonuevo["a18"] = response.data[i].a18;
							datonuevo["a19"] = response.data[i].a19;
							datonuevo["a20"] = response.data[i].a20;
							datonuevo["a21"] = response.data[i].a21;
							datonuevo["a22"] = response.data[i].a22;
							datonuevo["a23"] = response.data[i].a23;
							datonuevo["a24"] = response.data[i].a24;
							datonuevo["a25"] = response.data[i].a25;
							datonuevo["a26"] = response.data[i].a26;
							datonuevo["a27"] = response.data[i].a27;
							datonuevo["a28"] = response.data[i].a28;
							datonuevo["a29"] = response.data[i].a29;
							datonuevo["a30"] = response.data[i].a30;
							datonuevo["a31"] = response.data[i].a31;
							datonuevo["a32"] = response.data[i].a32;
							datonuevo["a33"] = response.data[i].a33;
							datonuevo["a34"] = response.data[i].a34;
							datonuevo["a35"] = response.data[i].a35;
							datonuevo["a36"] = response.data[i].a36;
							datonuevo["a37"] = response.data[i].a37;
							datonuevo["a38"] = response.data[i].a38;
							datonuevo["a39"] = response.data[i].a39;
							datonuevo["a40"] = response.data[i].a40;
							datonuevo["a41"] = response.data[i].a41;
							datonuevo["a42"] = response.data[i].a42;
							datonuevo["a43"] = response.data[i].a43;
							datonuevo["a44"] = response.data[i].a44;
							datonuevo["a45"] = response.data[i].a45;
							datonuevo["a46"] = response.data[i].a46;
							datonuevo["a47"] = response.data[i].a47;
							datonuevo["a48"] = response.data[i].a48;
							datonuevo["a49"] = response.data[i].a49;
							datonuevo["a50"] = response.data[i].a50;
							datonuevo["a51"] = response.data[i].a51;
							datonuevo["a52"] = response.data[i].a52;
							datonuevo["a53"] = response.data[i].a53;
							datonuevo["a54"] = response.data[i].a54;
							datonuevo["a55"] = response.data[i].a55;
							datonuevo["a56"] = response.data[i].a56;
							datonuevo["a57"] = response.data[i].a57;
							datonuevo["a58"] = response.data[i].a58;
							datonuevo["a59"] = response.data[i].a59;
							datonuevo["a60"] = response.data[i].a60;
							datonuevo["a61"] = response.data[i].a61;
							datonuevo["a62"] = response.data[i].a62;
							datonuevo["a63"] = response.data[i].a63;
							datonuevo["a64"] = response.data[i].a64;
							datonuevo["a65"] = response.data[i].a65;
							datonuevo["a66"] = response.data[i].a66;
							datonuevo["a67"] = response.data[i].a67;
							datonuevo["a68"] = response.data[i].a68;
							datonuevo["a69"] = response.data[i].a69;
							datonuevo["a70"] = response.data[i].a70;
							datonuevo["a71"] = response.data[i].a71;
							datonuevo["a72"] = response.data[i].a72;
							datonuevo["a73"] = response.data[i].a73;
							datonuevo["a74"] = response.data[i].a74;
							datonuevo["a75"] = response.data[i].a75;
							datonuevo["a76"] = response.data[i].a76;
							datonuevo["a77"] = response.data[i].a77;
							datonuevo["a78"] = response.data[i].a78;
							datonuevo["a79"] = response.data[i].a79;
							datonuevo["a80"] = response.data[i].a80;
							datonuevo["a81"] = response.data[i].a81;
							datonuevo["a82"] = response.data[i].a82;
							datonuevo["a83"] = response.data[i].a83;
							datonuevo["a84"] = response.data[i].a84;
							datonuevo["a85"] = response.data[i].a85;
							datonuevo["a86"] = response.data[i].a86;
							datonuevo["a87"] = response.data[i].a87;
							datonuevo["a88"] = response.data[i].a88;
							datonuevo["a89"] = response.data[i].a89;
							datonuevo["a90"] = response.data[i].a90;
							datonuevo["a91"] = response.data[i].a91;
							datonuevo["a92"] = response.data[i].a92;
							datonuevo["a93"] = response.data[i].a93;
							datonuevo["a94"] = response.data[i].a94;
							datonuevo["a95"] = response.data[i].a95;
							datonuevo["a96"] = response.data[i].a96;
							datonuevo["a97"] = response.data[i].a97;
							datonuevo["a98"] = response.data[i].a98;
							datonuevo["a99"] = response.data[i].a99;
							datonuevo["a100"] = response.data[i].a100;
							datonuevo["a101"] = response.data[i].a101;
							datonuevo["a102"] = response.data[i].a102;
							datonuevo["a103"] = response.data[i].a103;
							datonuevo["a104"] = response.data[i].a104;
							datonuevo["a105"] = response.data[i].a105;
							datonuevo["a106"] = response.data[i].a106;
							datonuevo["a107"] = response.data[i].a107;
							datonuevo["a108"] = response.data[i].a108;
							datonuevo["a109"] = response.data[i].a109;
							datonuevo["a110"] = response.data[i].a110;
							datonuevo["a111"] = response.data[i].a111;
							datonuevo["a112"] = response.data[i].a112;
							datonuevo["a113"] = response.data[i].a113;
							datonuevo["a114"] = response.data[i].a114;
							datonuevo["a115"] = response.data[i].a115;
							datonuevo["a116"] = response.data[i].a116;
							datonuevo["a117"] = response.data[i].a117;
							datonuevo["a118"] = response.data[i].a118;
							datonuevo["a119"] = response.data[i].a119;
							datonuevo["a120"] = response.data[i].a120;
							datonuevo["a121"] = response.data[i].a121;
							datonuevo["a122"] = response.data[i].a122;
							datonuevo["a123"] = response.data[i].a123;
							datonuevo["a124"] = response.data[i].a124;
							datonuevo["a125"] = response.data[i].a125;
							datonuevo["a126"] = response.data[i].a126;
							datonuevo["a127"] = response.data[i].a127;
							misDatosLinePeak.push(datonuevo);
						}
					})


					axios.get(url_dataLineOPeak).then((response) => {
						for (var i = 0; i < response.data.length; i++) {
							var datonuevo = {};
							datonuevo["zi"] = response.data[i].zona;
							datonuevo["anio"] = response.data[i].anio;
							datonuevo["a1"] = response.data[i].a1;
							datonuevo["a2"] = response.data[i].a2;
							datonuevo["a3"] = response.data[i].a3;
							datonuevo["a4"] = response.data[i].a4;
							datonuevo["a5"] = response.data[i].a5;
							datonuevo["a6"] = response.data[i].a6;
							datonuevo["a7"] = response.data[i].a7;
							datonuevo["a8"] = response.data[i].a8;
							datonuevo["a9"] = response.data[i].a9;
							datonuevo["a10"] = response.data[i].a10;
							datonuevo["a11"] = response.data[i].a11;
							datonuevo["a12"] = response.data[i].a12;
							datonuevo["a13"] = response.data[i].a13;
							datonuevo["a14"] = response.data[i].a14;
							datonuevo["a15"] = response.data[i].a15;
							datonuevo["a16"] = response.data[i].a16;
							datonuevo["a17"] = response.data[i].a17;
							datonuevo["a18"] = response.data[i].a18;
							datonuevo["a19"] = response.data[i].a19;
							datonuevo["a20"] = response.data[i].a20;
							datonuevo["a21"] = response.data[i].a21;
							datonuevo["a22"] = response.data[i].a22;
							datonuevo["a23"] = response.data[i].a23;
							datonuevo["a24"] = response.data[i].a24;
							datonuevo["a25"] = response.data[i].a25;
							datonuevo["a26"] = response.data[i].a26;
							datonuevo["a27"] = response.data[i].a27;
							datonuevo["a28"] = response.data[i].a28;
							datonuevo["a29"] = response.data[i].a29;
							datonuevo["a30"] = response.data[i].a30;
							datonuevo["a31"] = response.data[i].a31;
							datonuevo["a32"] = response.data[i].a32;
							datonuevo["a33"] = response.data[i].a33;
							datonuevo["a34"] = response.data[i].a34;
							datonuevo["a35"] = response.data[i].a35;
							datonuevo["a36"] = response.data[i].a36;
							datonuevo["a37"] = response.data[i].a37;
							datonuevo["a38"] = response.data[i].a38;
							datonuevo["a39"] = response.data[i].a39;
							datonuevo["a40"] = response.data[i].a40;
							datonuevo["a41"] = response.data[i].a41;
							datonuevo["a42"] = response.data[i].a42;
							datonuevo["a43"] = response.data[i].a43;
							datonuevo["a44"] = response.data[i].a44;
							datonuevo["a45"] = response.data[i].a45;
							datonuevo["a46"] = response.data[i].a46;
							datonuevo["a47"] = response.data[i].a47;
							datonuevo["a48"] = response.data[i].a48;
							datonuevo["a49"] = response.data[i].a49;
							datonuevo["a50"] = response.data[i].a50;
							datonuevo["a51"] = response.data[i].a51;
							datonuevo["a52"] = response.data[i].a52;
							datonuevo["a53"] = response.data[i].a53;
							datonuevo["a54"] = response.data[i].a54;
							datonuevo["a55"] = response.data[i].a55;
							datonuevo["a56"] = response.data[i].a56;
							datonuevo["a57"] = response.data[i].a57;
							datonuevo["a58"] = response.data[i].a58;
							datonuevo["a59"] = response.data[i].a59;
							datonuevo["a60"] = response.data[i].a60;
							datonuevo["a61"] = response.data[i].a61;
							datonuevo["a62"] = response.data[i].a62;
							datonuevo["a63"] = response.data[i].a63;
							datonuevo["a64"] = response.data[i].a64;
							datonuevo["a65"] = response.data[i].a65;
							datonuevo["a66"] = response.data[i].a66;
							datonuevo["a67"] = response.data[i].a67;
							datonuevo["a68"] = response.data[i].a68;
							datonuevo["a69"] = response.data[i].a69;
							datonuevo["a70"] = response.data[i].a70;
							datonuevo["a71"] = response.data[i].a71;
							datonuevo["a72"] = response.data[i].a72;
							datonuevo["a73"] = response.data[i].a73;
							datonuevo["a74"] = response.data[i].a74;
							datonuevo["a75"] = response.data[i].a75;
							datonuevo["a76"] = response.data[i].a76;
							datonuevo["a77"] = response.data[i].a77;
							datonuevo["a78"] = response.data[i].a78;
							datonuevo["a79"] = response.data[i].a79;
							datonuevo["a80"] = response.data[i].a80;
							datonuevo["a81"] = response.data[i].a81;
							datonuevo["a82"] = response.data[i].a82;
							datonuevo["a83"] = response.data[i].a83;
							datonuevo["a84"] = response.data[i].a84;
							datonuevo["a85"] = response.data[i].a85;
							datonuevo["a86"] = response.data[i].a86;
							datonuevo["a87"] = response.data[i].a87;
							datonuevo["a88"] = response.data[i].a88;
							datonuevo["a89"] = response.data[i].a89;
							datonuevo["a90"] = response.data[i].a90;
							datonuevo["a91"] = response.data[i].a91;
							datonuevo["a92"] = response.data[i].a92;
							datonuevo["a93"] = response.data[i].a93;
							datonuevo["a94"] = response.data[i].a94;
							datonuevo["a95"] = response.data[i].a95;
							datonuevo["a96"] = response.data[i].a96;
							datonuevo["a97"] = response.data[i].a97;
							datonuevo["a98"] = response.data[i].a98;
							datonuevo["a99"] = response.data[i].a99;
							datonuevo["a100"] = response.data[i].a100;
							datonuevo["a101"] = response.data[i].a101;
							datonuevo["a102"] = response.data[i].a102;
							datonuevo["a103"] = response.data[i].a103;
							datonuevo["a104"] = response.data[i].a104;
							datonuevo["a105"] = response.data[i].a105;
							datonuevo["a106"] = response.data[i].a106;
							datonuevo["a107"] = response.data[i].a107;
							datonuevo["a108"] = response.data[i].a108;
							datonuevo["a109"] = response.data[i].a109;
							datonuevo["a110"] = response.data[i].a110;
							datonuevo["a111"] = response.data[i].a111;
							datonuevo["a112"] = response.data[i].a112;
							datonuevo["a113"] = response.data[i].a113;
							datonuevo["a114"] = response.data[i].a114;
							datonuevo["a115"] = response.data[i].a115;
							datonuevo["a116"] = response.data[i].a116;
							datonuevo["a117"] = response.data[i].a117;
							datonuevo["a118"] = response.data[i].a118;
							datonuevo["a119"] = response.data[i].a119;
							datonuevo["a120"] = response.data[i].a120;
							datonuevo["a121"] = response.data[i].a121;
							datonuevo["a122"] = response.data[i].a122;
							datonuevo["a123"] = response.data[i].a123;
							datonuevo["a124"] = response.data[i].a124;
							datonuevo["a125"] = response.data[i].a125;
							datonuevo["a126"] = response.data[i].a126;
							datonuevo["a127"] = response.data[i].a127;
							misDatosLineOPeak.push(datonuevo);
						}
					})
				}


				var getData = (anio, zona, top) => {

					var datos1 = [];
					var datos2 = [];
					var datos3 = [];
					var datos4 = [];

					for (var i = 0; i < misDatos.length; i++) {
						
						if(misDatos[i].zi == zona && misDatos[i].anio == anio){
							var datonuevo1 = {};
							var datonuevo2 = {};

							datonuevo1["rows"] = misDatos[i].rows;
							datonuevo1["co2_tm_opeak"] = misDatos[i].co2_tm_opeak;
							datonuevo1["co2_tpc_opeak"] = misDatos[i].co2_tpc_opeak;
							datonuevo1["co2_car_opeak"] = misDatos[i].co2_car_opeak;
							datonuevo1[""] = 0;
							datos1.push(datonuevo1);

							datonuevo2["rows"] = misDatos[i].rows;
							datonuevo2["co2_tm_peak"] = misDatos[i].co2_tm_peak;
							datonuevo2["co2_tpc_peak"] = misDatos[i].co2_tpc_peak;
							datonuevo2["co2_car_peak"] = misDatos[i].co2_car_peak;
							datonuevo2[""] = 0;
							datos2.push(datonuevo2);

								
						}
					}
					datos1 = datos1.sort(compareItemsOPeak);
					datos1 = datos1.slice(0,top);
					generateviz1(datos1);

					datos2 = datos2.sort(compareItemsPeak);	
					datos2 = datos2.slice(0,top);				
					generateviz2(datos2);



					//Construccion de conjunto de datos para line chart

					//Lineas 1 - opeak
					var zonasLineChart = [];
					for(var k = 0; k<datos1.length; k++){
						zonasLineChart.push(datos1[k].rows);
					}

					for (var i = allGroup.length -1 ; i>=0 ; i--){
						for (var j = 0; j<misDatosLineOPeak.length; j++){
							if (misDatosLineOPeak[j].anio == i && misDatosLineOPeak[j].zi == zona ){								
								var datonuevo3 = {};
								datonuevo3["Date"] =  parseTimeLin("0"+i);
								for(var m = 0 ; m < zonasLineChart.length; m++){
									var zoneaux = zonasLineChart[m];
									datonuevo3[zoneaux] = misDatosLineOPeak[j][zoneaux];
								}
								datos3.push(datonuevo3);	
								break;
							}
						}
					}

					var columns_l1 = ["Date"];
					for( var n = 0 ; n < zonasLineChart.length; n++){
						columns_l1.push(zonasLineChart[n]);
					}

					datos3["columns"] = columns_l1;				
					generatevizLin1(datos3);


					//Lineas 2 -  peak

					var zonasLineChart2 = [];
					for(var k = 0; k<datos2.length; k++){
						zonasLineChart2.push(datos2[k].rows);
					}

					for (var i = allGroup.length -1 ; i>=0 ; i--){
						for (var j = 0; j<misDatosLinePeak.length; j++){
							if (misDatosLinePeak[j].anio == i && misDatosLinePeak[j].zi == zona ){								
								var datonuevo4 = {};
								datonuevo4["Date"] =  parseTimeLin("0"+i);
								for(var m = 0 ; m < zonasLineChart2.length; m++){
									var zoneaux = zonasLineChart2[m];
									datonuevo4[zoneaux] = misDatosLinePeak[j][zoneaux];
								}
								datos4.push(datonuevo4);	
								break;
							}
						}
					}

					var columns_l2 = ["Date"];
					for( var n = 0 ; n < zonasLineChart2.length; n++){
						columns_l2.push(zonasLineChart2[n]);
					}

					datos4["columns"] = columns_l2;				
					generatevizLin2(datos4);

				}




				var generateviz1 = (data) => {

				  d3v3.select("#dataviz > svg").remove(); 

				  var svg = d3v3.select(".dataviz")
				   .append("svg")
					.attr("width", width + margin.left + margin.right)
					.attr("height", height + margin.top + margin.bottom)
				  	.append("g")
					.attr("transform", "translate(" + margin.left + "," + margin.top + ")");


				  var rateNames = d3v3.keys(data[0]).filter(function(key) { return key !== "rows"; });
				  var rowsNames = data.map(function(d) { return d.rows; });
				  var neutralIndex = Math.floor(rateNames.length/2);					

				  color.domain(rateNames);
				  
				  data.forEach(function(row) {					
					row.total = d3v3.sum(rateNames.map(function(name) { return +row[name]; }));				
					rateNames.forEach(function(name) { row['relative'+name] = (row.total !==0 ? +row[name] : 0); });
				
					var x0 = -1 * d3v3.sum(rateNames.map(function(name,i) { return i < neutralIndex ? +row['relative'+name] : 0; }));
					if (rateNames.length & 1) x0 += -1 * row['relative' + rateNames[neutralIndex] ]/2;   
					
					row.boxes = rateNames.map(function(name) { 
					  return {name: name, x0: x0, x1: x0 += row['relative'+name], total: row.total, absolute: row[name]}; 
					});
				  });
				
				  var min = d3v3.min(data, function(d) { return d.boxes["0"].x0; });
				  var max = d3v3.max(data, function(d) { return d.boxes[d.boxes.length-1].x1; });


				// tooltips

				//Create a tooltip
				var Tooltip = d3v3.select('#dataviz')
					.append('div')
					.attr("class", "tooltip")
					.style('position', 'absolute')
					.style('background-color', 'rgba(250,250,250,1.0)')
					.style('border-radius', '5px')
					.style('padding', '5px')
					.style('opacity', 0)
					.style("font-family", "Tahoma, Geneva, sans-serif")
					.style("font-size", "11pt");
					
				function mouseover(){
					d3v3.select(this).selectAll('rect').style('opacity', '0.5');
					Tooltip
					.style('opacity', 1)
					.style('box-shadow', '5px 5px 5px rgba(0,0,0,0.6)');
				}

				function mousemove(){
					var d = d3v3.select(this).data()[0]
					Tooltip
					.html('<b>co2_tm_opeak:</b> <font color="' + color_co2_tm_opeak +'">' + d.co2_tm_opeak + '</font> </br>' + 
						'<b>co2_tpc_opeak:</b> <font color="' + color_co2_tpc_opeak +'">' + d.co2_tpc_opeak +'</font> </br>' +
						'<b>co2_car_opeak:</b> <font color="'+ color_co2_car_opeak +'">'+ d.co2_car_opeak+'</font>')
					.style("left", ((d3v3.mouse(this)[0]) + graph_1_Tool_x_trans) + "px")
					.style("top", (d3v3.event.pageY-630) + "px");

				}
				function mouseout(){
					if ((d3v3.select(this).data()[0]).rows != ( barSelected!=null ? barSelected.rows:"0")){
						d3v3.select(this).selectAll('rect').style('opacity', '1');
						
					}
					Tooltip.style("opacity", 0);
					
				}

				// When clicked, zoom in
				function clickedBar1() {

					if( barSelected == null ||  (d3v3.select(this).data()[0]).rows != barSelected.rows){
						
						var d = d3v3.select(this).data()[0];
						if(barSelected != null){
							rows1.selectAll("rect").style('outline','thin solid white').style('opacity', function(d2){return '1'});
							rows2.selectAll("rect").style('outline','thin solid white').style('opacity', function(d2){return '1'});
						}
						barSelected = d3v3.select(this).data()[0];
						getElementAreaByUPZName(d.rows);
						d3v3.select(this).selectAll('rect').style('outline','thin solid ' + color_selected_destination).style('outline-width', '3px').style('opacity', '0.5');
					}
					
				}
				
				  x.domain([min, max]).nice();
				  y.domain(rowsNames);
				
				  svg.append("g")
					 .attr("class", "x axis")
					 .call(xAxis);
				
				  svg.append("g")
					 .attr("class", "y axis")
					 .call(yAxis);
				
				  rows1 = svg.selectAll(".row")
					  .data(data)
					  .enter().append("g")
					  .attr("class", "bar")
					  .attr("transform", function(d) { return "translate(0," + y(d.rows) + ")"; })
					  
					  .on('mouseover', mouseover)
        			  .on('mousemove', mousemove)
					  .on('mouseout', mouseout)
					  .on('click', clickedBar1)
					  ;
				
				  var bars = rows1.selectAll("rect")
					.data(function(d) { return d.boxes; })
					.enter().append("g").attr("class", "barra")
					//.on('mouseover', mouseover)
        			//.on('mousemove', mousemove)
        			//.on('mouseout', mouseout);
					  
				  bars.append("rect")
					  .attr("height", y.rangeBand())
					  .attr("x", function(d) { return x(d.x0); })
					  .attr("width", function(d) { return x(d.x1) - x(d.x0); })
					  .style("fill", function(d) { return color(d.name); });
				
				  /*bars.append("text")
					.attr("x", function(d) { return x(d.x0); })
					.attr("y", y.rangeBand()/2)
					.attr("dy", "0.5em")
					.attr("dx", "0.5em")
					.style("text-anchor", "begin")
					.text(function(d) { return d.absolute !== 0 && (d.x1-d.x0)>0.04 ? d.absolute : "" });
				*/
				  svg.append("g")
					  .attr("class", "y axis")
					.append("line")
					  .attr("x1", x(0))
					  .attr("x2", x(0))
					  .attr("y2", height);
				
				  var legend = svg.selectAll(".legend")
					  .data(rateNames)
					.enter().append("g")
					  .attr("class", "legend")
					  .attr("transform", function(d, i) { return "translate(" + width/rateNames.length * i + ",-55)"; });
				
				  legend.append("rect")
						.attr("x", 0)
						.attr("width", 18)
						.attr("height", 18)
						.style("fill", color);
				
				  legend.append("text")
						.attr("x", 22)
						.attr("y", 9)
						.attr("dy", ".35em")
						.style("text-anchor", "begin")
						.text(function(d) { return d; });
						
				};


				var generateviz2 = (data) => {

					d3v3.select("#dataviz2 > svg").remove(); 

					var svg2 = d3v3.select(".dataviz2")
					.append("svg")
					.attr("width", width + margin.left + margin.right)
					.attr("height", height + margin.top + margin.bottom)
				  	.append("g")
					.attr("transform", "translate(" + margin.left + "," + margin.top + ")");


				  var rateNames = d3v3.keys(data[0]).filter(function(key) { return key !== "rows"; });
				  var rowsNames = data.map(function(d) { return d.rows; });
				  var neutralIndex = Math.floor(rateNames.length/2);					

				  color.domain(rateNames);
				  
				  data.forEach(function(row) {
					row.total = d3v3.sum(rateNames.map(function(name) { return +row[name]; }));				
					rateNames.forEach(function(name) { row['relative'+name] = (row.total !==0 ? +row[name] : 0); });
				
					var x0 = -1 * d3v3.sum(rateNames.map(function(name,i) { return i < neutralIndex ? +row['relative'+name] : 0; }));
					if (rateNames.length & 1) x0 += -1 * row['relative' + rateNames[neutralIndex] ]/2;   

					row.boxes = rateNames.map(function(name) { 
					  return {name: name, x0: x0, x1: x0 += row['relative'+name], total: row.total, absolute: row[name]}; 
					});
				  });
				
				  var min = d3v3.min(data, function(d) { return d.boxes["0"].x0; });
				  var max = d3v3.max(data, function(d) { return d.boxes[d.boxes.length-1].x1; });
				

				  // tooltips

				//Create a tooltip
				var Tooltip = d3v3.select('#dataviz2')
					.append('div')
					.attr("class", "tooltip")
					.style('position', 'absolute')
					.style('background-color', 'rgba(250,250,250,1.0)')
					.style('border-radius', '5px')
					.style('padding', '5px')
					.style('opacity', 0)
					.style("font-family", "Tahoma, Geneva, sans-serif")
					.style("font-size", "11pt");
					
				function mouseover(){
					d3v3.select(this).selectAll('rect').style('opacity', '0.1');
					Tooltip
					.style('opacity', 1)
					.style('box-shadow', '5px 5px 5px rgba(0,0,0,0.6)');
				}

				function mousemove(){
					var d = d3v3.select(this).data()[0]
					Tooltip
					.html('<b>co2_tm_peak:</b> <font color="' + color_co2_tm_peak +'">' + d.co2_tm_peak + '</font> </br>' + 
						'<b>co2_tpc_peak:</b> <font color="' + color_co2_tpc_peak +'">' + d.co2_tpc_peak +'</font> </br>' +
						'<b>co2_car_peak:</b> <font color="'+ color_co2_car_peak +'">'+ d.co2_car_peak+'</font>')
					.style("left", ((d3v3.mouse(this)[0]) + graph_2_Tool_x_trans) + "px")
					.style("top", (d3v3.event.pageY-630) + "px");

				}
				function mouseout(){

					if ((d3v3.select(this).data()[0]).rows != ( barSelected!=null ? barSelected.rows:"0")){
						d3v3.select(this).selectAll('rect').style('opacity', '1');
						
					}
					Tooltip.style("opacity", 0);

				}

				// When clicked, zoom in
				function clickedBar1() {
					if( barSelected == null ||  (d3v3.select(this).data()[0]).rows != barSelected.rows){
						
						var d = d3v3.select(this).data()[0];
						if(barSelected != null){
							rows2.selectAll("rect").style('outline','thin solid white').style('opacity', function(d2){return '1'});
							rows1.selectAll("rect").style('outline','thin solid white').style('opacity', function(d2){return '1'});
							
						}
						barSelected = d3v3.select(this).data()[0];
						getElementAreaByUPZName(d.rows);
						d3v3.select(this).selectAll('rect').style('outline','thin solid ' + color_selected_destination).style('outline-width', '3px').style('opacity', '0.5');
					}
				}

				  x.domain([min, max]).nice();
				  y.domain(rowsNames);
				
				  svg2.append("g")
					 .attr("class", "x axis")
					 .call(xAxis);
				
				  svg2.append("g")
					 .attr("class", "y axis")
					 .call(yAxis);
				
				  rows2 = svg2.selectAll(".row")
					  .data(data)
					  .enter().append("g")
					  .attr("class", "bar")
					  .attr("transform", function(d) { return "translate(0," + y(d.rows) + ")"; })
					  
					  .on('mouseover', mouseover)
        			  .on('mousemove', mousemove)
					  .on('mouseout', mouseout)
					  .on('click', clickedBar1);
				
				var bars = rows2.selectAll("rect")
					  .data(function(d) { return d.boxes; })
					  .enter().append("g").attr("class", "barra")
					  //.on('mouseover', mouseover)
        			  //.on('mousemove', mousemove)
        			  //.on('mouseout', mouseout);;

				  bars.append("rect")
					  .attr("height", y.rangeBand())
					  .attr("x", function(d) { return x(d.x0); })
					  .attr("width", function(d) { return x(d.x1) - x(d.x0); })
					  .style("fill", function(d) { return color(d.name); });
				
					  /*
				  bars.append("text")
					.attr("x", function(d) { return x(d.x0); })
					.attr("y", y.rangeBand()/2)
					.attr("dy", "0.5em")
					.attr("dx", "0.5em")
					.style("text-anchor", "begin")
					.text(function(d) { return d.absolute !== 0 && (d.x1-d.x0)>0.04 ? d.absolute : "" });
				*/

				  svg2.append("g")
					  .attr("class", "y axis")
					.append("line")
					  .attr("x1", x(0))
					  .attr("x2", x(0))
					  .attr("y2", height);
				
				  var legend = svg2.selectAll(".legend")
					  .data(rateNames)
					.enter().append("g")
					  .attr("class", "legend")
					  .attr("transform", function(d, i) { return "translate(" + width/rateNames.length * i + ",-55)"; });
				
				  legend.append("rect")
						.attr("x", 0)
						.attr("width", 18)
						.attr("height", 18)
						.style("fill", color);
				
				  legend.append("text")
						.attr("x", 22)
						.attr("y", 9)
						.attr("dy", ".35em")
						.style("text-anchor", "begin")
						.text(function(d) { return d; });
				
				};

				//-----------------------------------------------------------------------------------------------------------------------------------
				//GRAFICOS DE LINEAS
				var marginLin = {top: 30, right: 60, bottom: 50, left: 60};
				var widthLin = 960/2 - marginLin.left - marginLin.right;
				var heightLin = 500 - marginLin.top - marginLin.bottom;
				
				var colorLin = d3v4.scaleOrdinal(d3v4.schemeCategory10);
				//var colorLin2 = d3v4.scaleOrdinal(d3v4.schemeCategory10);

				var browser1;
				var browser;


				function getTextUpzById(id_zona){
					
					for (var i = 0 ; i<allGroupZonas.length; i++){
						var elemento1 =allGroupZonas[i].split("-")[0].trim();
						var elemento2 = id_zona.replace("a","UPZ ");

						if(elemento1===elemento2){
							var splited = allGroupZonas[i].split("-");
							return (splited[1].trim() + " (" + splited[0].replace(" ","").trim() + ")");	
						}
					} 
					return "NA";
					
				}

				var xRangelin = d3v4.scaleTime()
        		.rangeRound([0, widthLin]);

				var yRangelin = d3v4.scaleLinear()
					.range([heightLin, 0]);

				var line = d3v4.line()
					.x(function(d) { return xRangelin(d.Date);  })
					.y(function(d) { return yRangelin(d.co2);  })
					//.curve(d3v4.curveMonotoneX)
					;

				var generatevizLin1 = (data) => {
					d3v4.select("#datavizlin1 > svg").remove(); 

					var glin1 = d3v4.select("#datavizlin1")
					.append("svg")
					.attr("height", 500)
					.attr("width", 960/2)
					.append("g")
					.attr("transform", "translate(" + marginLin.left + "," + marginLin.top + ")");

					var browsers = data.columns.slice(1).map(function(id) {
					return {
					id: id,
					values: data.map(function(d) {
					return {Date: d.Date, co2: d[id]};
					})
					};     
					});

					xRangelin.domain(d3v4.extent(data, function(d) { return d.Date; }));

					yRangelin.domain([
						d3v4.min(browsers, function(c) { return d3v4.min(c.values, function(d) { return d.co2; }); }),
						d3v4.max(browsers, function(c) { return d3v4.max(c.values, function(d) { return d.co2; }); })
					]);

					colorLin.domain(browsers.map(function(c) { return c.id; }));

					glin1.append("g")
						.attr("class", "axis")
						.attr("transform", "translate(0," + heightLin + ")")
						.call(d3v4.axisBottom(xRangelin).tickFormat(d3v4.timeFormat("%y")))
						.style("text-anchor", "middle")
						.attr("dx", "-.1em");

					glin1.append("g")
						.attr("class", "axis")
						.call(d3v4.axisLeft(yRangelin))
						.append("text")
						.attr("x",2)
						.attr("y", 6)
						.attr("dy", "0.71em")
						.attr("fill", "#000")
						.attr("text-anchor", "start")
						.text("CO2 (Toneladas)");

					browser1 = glin1.selectAll(".browsers")
						.data(browsers)
						.enter()
						.append("g")
						.attr("class", "browser");

					browser1.append("path")
						.style("fill", "none")
						.attr("class", "line")
						.attr("d", function(d) { return line(d.values); })
						.style("stroke", function(d) { return colorLin(d.id); })
						.style("stroke-width", "2px")
						.on('mouseover', mouseoverLine)
						.on('mouseout', mouseOutLine)
						.on('click', clickLine)
						;
						
					browser1.append("text")
						.datum(function(d) { return {id: d.id, value: d.values[0]}; })
						.attr("transform", function(d) { return "translate(" + xRangelin(d.value.Date) + "," + yRangelin(d.value.co2) + ")"; })
						.attr("x", 3)
						.attr("dy", "0.35em")
						.style("font", "10px sans-serif")
						.text(function(d) { return d.id; });




					//Agregar puntos a la linea
					glin1.selectAll("myDots")
						.data(browsers)
						.enter()
							.append('g')
							.style("fill", function(d){ return colorLin(d.id); })
							.attr("class", function(d){ return "value"+d.id;})
						// Second we need to enter in the 'values' part of this group
						.selectAll("myPoints")
						.data(function(d){ return d.values })
						.enter()
						.append("circle")
							.attr("cx", function(d) { return xRangelin(d.Date) } )
							.attr("cy", function(d) { return yRangelin(d.co2) } )
							.attr("r", 5) 	
							.attr("stroke", "white")
							.on('mouseover', mouseoverPoint)
							.on('mouseout', mouseOutPoint);

					// Define the div for the tooltip de puntos
					var div = d3v4.select("body").append("div")	
						.attr("class", "tooltip2")				
						.style("opacity", 0);








					function mouseOutPoint(d){
						d3v4.select(this).style('r', 5);

						div.transition()		
							.duration(500)		
							.style("opacity", 0);	
					}
	
					var formatTime = d3v4.timeFormat("%y")
					var formatSuffixDecimal2 = d3v4.format(".3s")
					function mouseoverPoint(d){
						d3v4.select(this).style('r', 7);
						div.transition()		
							.duration(200)		
							.style("opacity", .9);		
						div	.html("Año="+formatTime(d.Date) + "<br/>"  +"CO2="+formatSuffixDecimal2(d.co2) )
							.style("left", (d3v4.event.pageX) + "px")		
							.style("top", (d3v4.event.pageY - 28) + "px");
					}


					function mouseoverLine(d){
						if(d !== lineSelected){
							d3v4.select(this).style("stroke-width", "5px").style('border','5px solid red');
						}
						

						
						
					}

					function mouseOutLine(d){
						if(d !== lineSelected ){
							d3v4.select(this).style("stroke-width", "2px");
						}
					}





					function clickLine(d){
						//ELIMINA LA LINEA AL PRESIONAR CNTROL+CLICK
						if (d3v4.event.ctrlKey) {
							for(var i = 0; i<data.length; i++){
								delete data[i][d.id];
							}
							const index = data["columns"].indexOf(d.id);
							if (index > -1) {
								data["columns"].splice(index, 1);
							}
							generatevizLin1(data);

							if(d === lineSelected){
								isLineSelected = false;
								lineSelected = null;
								d3v4.select(this).style("stroke-width", "2px");
								dummyTextMap_destination_line.style('opacity', 0);
								fillAreaWithLineColor("NA",colorLin(d.id))
							}
						}
						else {
							if(d === lineSelected && isLineSelected){
								isLineSelected = false;
								lineSelected = null;
								d3v4.select(this).style("stroke-width", "2px");
								dummyTextMap_destination_line.style('opacity', 0);
								fillAreaWithLineColor("NA",colorLin(d.id))
							}
							else{
								browser1.selectAll(".line").style('stroke-width', function(d){return "2px"})
								browser.selectAll(".line").style('stroke-width', function(d){return "2px"})
								lineSelected = d;
								isLineSelected = true;
								d3v4.select(this).style("stroke-width", "10px");
								dummyTextMap_destination_line.style('opacity', 1);
								textArtSelectedLine(getTextUpzById(d.id),colorLin(d.id));
								fillAreaWithLineColor(d.id,colorLin(d.id))
							}
						}
						
					}
				}



				var generatevizLin2 = (data) => {
					d3v4.select("#datavizlin2 > svg").remove(); 

					var glin1 = d3v4.select("#datavizlin2")
					.append("svg")
					.attr("height", 500)
					.attr("width", 960/2)
					.append("g")
					.attr("transform", "translate(" + marginLin.left + "," + marginLin.top + ")");

					var browsers = data.columns.slice(1).map(function(id) {
					return {
					id: id,
					values: data.map(function(d) {
					return {Date: d.Date, co2: d[id]};
					})
					};     
					});

					xRangelin.domain(d3v4.extent(data, function(d) { return d.Date; }));

					yRangelin.domain([
						d3v4.min(browsers, function(c) { return d3v4.min(c.values, function(d) { return d.co2; }); }),
						d3v4.max(browsers, function(c) { return d3v4.max(c.values, function(d) { return d.co2; }); })
					]);

					//colorLin2.domain(browsers.map(function(c) { return c.id; }));

					glin1.append("g")
						.attr("class", "axis")
						.attr("transform", "translate(0," + heightLin + ")")
						.call(d3v4.axisBottom(xRangelin).tickFormat(d3v4.timeFormat("%y")))
						.style("text-anchor", "middle")
						.attr("dx", "-.1em");

					glin1.append("g")
						.attr("class", "axis")
						.call(d3v4.axisLeft(yRangelin))
						.append("text")
						.attr("x",2)
						.attr("y", 6)
						.attr("dy", "0.71em")
						.attr("fill", "#000")
						.attr("text-anchor", "start")
						.text("CO2 (Toneladas)");

					browser = glin1.selectAll(".browsers")
						.data(browsers)
						.enter()
						.append("g")
						.attr("class", "browser");

					browser.append("path")
						.style("fill", "none")
						.attr("class", "line")
						.attr("d", function(d) { return line(d.values); })
						.style("stroke", function(d) { return colorLin(d.id); })
						.style("stroke-width", "2px")
						.on('mouseover', mouseoverLine2)
						.on('mouseout', mouseOutLine2)
						.on('click', clickLine2)
						;
					browser.append("text")
						.datum(function(d) { return {id: d.id, value: d.values[0]}; })
						.attr("transform", function(d) { return "translate(" + xRangelin(d.value.Date) + "," + yRangelin(d.value.co2) + ")"; })
						.attr("x", 3)
						.attr("dy", "0.35em")
						.style("font", "10px sans-serif")
						.text(function(d) { return d.id; });

					//Agregar puntos a la linea
					glin1.selectAll("myDots")
						.data(browsers)
						.enter()
							.append('g')
							.style("fill", function(d){ return colorLin(d.id); })
							.attr("class", function(d){ return "value"+d.id;})
						// Second we need to enter in the 'values' part of this group
						.selectAll("myPoints")
						.data(function(d){ return d.values })
						.enter()
						.append("circle")
							.attr("cx", function(d) { return xRangelin(d.Date) } )
							.attr("cy", function(d) { return yRangelin(d.co2) } )
							.attr("r", 5) 	
							.attr("stroke", "white")
							.on('mouseover', mouseoverPoint2)
							.on('mouseout', mouseOutPoint2);


					// Define the div for the tooltip de puntos
					var div = d3v4.select("body").append("div")	
						.attr("class", "tooltip2")				
						.style("opacity", 0);

					
					function mouseOutPoint2(d){
						d3v4.select(this).style('r', 5);

						div.transition()		
							.duration(500)		
							.style("opacity", 0);	
					}
	
					var formatTime = d3v4.timeFormat("%y")
					var formatSuffixDecimal2 = d3v4.format(".3s")
					function mouseoverPoint2(d){
						d3v4.select(this).style('r', 7);
						div.transition()		
							.duration(200)		
							.style("opacity", .9);		
						div	.html("Año="+formatTime(d.Date) + "<br/>"  +"CO2="+formatSuffixDecimal2(d.co2) )
							.style("left", (d3v4.event.pageX) + "px")		
							.style("top", (d3v4.event.pageY - 28) + "px");
					}


					function mouseoverLine2(d){
						if(d !== lineSelected){
							d3v4.select(this).style("stroke-width", "5px").style('border','5px solid red');
						}
						

						
						
					}

					function mouseOutLine2(d){
						if(d !== lineSelected ){
							d3v4.select(this).style("stroke-width", "2px");
						}
					}





					function clickLine2(d){
						//ELIMINA LA LINEA AL PRESIONAR CNTROL+CLICK
						if (d3v4.event.ctrlKey) {
							for(var i = 0; i<data.length; i++){
								delete data[i][d.id];
							}
							const index = data["columns"].indexOf(d.id);
							if (index > -1) {
								data["columns"].splice(index, 1);
							}
							generatevizLin2(data);

							if(d === lineSelected){
								isLineSelected = false;
								lineSelected = null;
								d3v4.select(this).style("stroke-width", "2px");
								dummyTextMap_destination_line.style('opacity', 0);
								fillAreaWithLineColor("NA",colorLin2(d.id))
							}
						}
						else {
							if(d === lineSelected && isLineSelected){
								isLineSelected = false;
								lineSelected = null;
								d3v4.select(this).style("stroke-width", "2px");
								dummyTextMap_destination_line.style('opacity', 0);
								fillAreaWithLineColor("NA",colorLin2(d.id))
							}
							else{
								browser1.selectAll(".line").style('stroke-width', function(d){return "2px"})
								browser.selectAll(".line").style('stroke-width', function(d){return "2px"})
								lineSelected = d;
								isLineSelected = true;
								d3v4.select(this).style("stroke-width", "10px");
								dummyTextMap_destination_line.style('opacity', 1);
								textArtSelectedLine(getTextUpzById(d.id),colorLin(d.id));
								fillAreaWithLineColor(d.id,colorLin(d.id))
							}
						}
						
					}
				}




				//-----------------------------------------------------------------------------------------------------------------------------------
				//Se leen los datos y se hace la visualizacion inicial 
				readDataBarChart()
				readDataLineChart()
				
				</script>



			<div class="row mt-5 py-md-5">
				<div class="col text-center">
					<div class="block-27">
					</div>
				</div>
			</div>
			
		
		</div>
	</section>

	

	<footer class="ftco-footer ftco-section">
		<div class="degree-footer-top"></div>
		<div class="container">
			<!--
			<div class="row mb-5">
				<div class="col-md">
					<div class="ftco-footer-widget mb-4">
						<h2 class="ftco-heading-2">avo</h2>
						<p>Far far away, behind the word mountains, far from the countries.</p>
						<ul class="ftco-footer-social list-unstyled mt-5">
							<li class="ftco-animate"><a href="#"><span class="fa fa-twitter"></span></a></li>
							<li class="ftco-animate"><a href="#"><span class="fa fa-facebook"></span></a></li>
							<li class="ftco-animate"><a href="#"><span class="fa fa-instagram"></span></a></li>
						</ul>
					</div>
				</div>
				<div class="col-md">
					<div class="ftco-footer-widget mb-4 ml-md-4">
						<h2 class="ftco-heading-2">Community</h2>
						<ul class="list-unstyled">
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Projects</a></li>
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Team</a></li>
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Reviews</a></li>
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>FAQs</a></li>
						</ul>
					</div>
				</div>
				<div class="col-md">
					<div class="ftco-footer-widget mb-4 ml-md-4">
						<h2 class="ftco-heading-2">About Us</h2>
						<ul class="list-unstyled">
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Our Story</a></li>
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Meet the team</a></li>
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Careers</a></li>
						</ul>
					</div>
				</div>
				<div class="col-md">
					<div class="ftco-footer-widget mb-4">
						<h2 class="ftco-heading-2">Company</h2>
						<ul class="list-unstyled">
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>About Us</a></li>
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Press</a></li>
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Contact</a></li>
							<li><a href="#"><span class="fa fa-chevron-right mr-2"></span>Careers</a></li>
						</ul>
					</div>
				</div>
				<div class="col-md">
					<div class="ftco-footer-widget mb-4">
						<h2 class="ftco-heading-2">Have a Questions?</h2>
						<div class="block-23 mb-3">
							<ul>
								<li><span class="icon fa fa-map"></span><span class="text">203 Fake St. Mountain View, San Francisco, California, USA</span></li>
								<li><a href="#"><span class="icon fa fa-phone"></span><span class="text">+2 392 3929 210</span></a></li>
								<li><a href="#"><span class="icon fa fa-envelope pr-4"></span><span class="text">info@yourdomain.com</span></a></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
			-->
			<div class="row">
				<div class="col-md-12 text-center">
					
					<p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
						Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
						<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
					</div>
				</div>
			</div>
		</footer>
		
		

		<!-- loader -->
		<div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00"/></svg></div>


		<script src="js/jquery.min.js"></script>
		<script src="js/jquery-migrate-3.0.1.min.js"></script>
		<script src="js/popper.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/jquery.easing.1.3.js"></script>
		<script src="js/jquery.waypoints.min.js"></script>
		<script src="js/jquery.stellar.min.js"></script>
		<script src="js/owl.carousel.min.js"></script>
		<script src="js/jquery.magnific-popup.min.js"></script>
		<script src="js/jquery.animateNumber.min.js"></script>
		<script src="js/scrollax.min.js"></script>
		<script src="js/main.js"></script>
		
	</body>
	</html>